---
import { Default } from "@layouts";
import { datocms } from "@lib";
import query from "./_index.query.graphql";
import { Blocks } from "@blocks";
import { AllPagesQuery } from "@lib/queries";

export async function getStaticPaths() {
  const locales = ["nl", "en"];
  const allPages = await datocms.request(AllPagesQuery);
  const allStaticPaths = locales
    .map((locale) =>
      allPages[locale].map((page: any) => {
        if (page.parentPage) page.slug = `${page.parentPage.slug}/${page.slug}`;
        return { params: { locale, path: page.slug } };
      })
    )
    .flat();
  return allStaticPaths;
}

const { locale, path } = Astro.params;
const slug = await path.split("/").pop();

const { app, site, page } = await datocms.request(query, { locale, slug });
---

<Default {app} {site} {page}>
  <Blocks blocks={page.body} />
</Default>
